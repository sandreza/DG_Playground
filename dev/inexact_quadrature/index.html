<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Variational Crimes · DG_Playground</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">DG_Playground</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Discontinuous Galerkin</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../dg_methods/">Home</a></li><li><a class="tocitem" href="../dg_single_element/">Single Element</a></li><li><a class="tocitem" href="../boundary_conditions/">Boundary Conditions</a></li><li class="is-active"><a class="tocitem" href>Variational Crimes</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Exact-quadrature-version-1"><span>Exact quadrature version 1</span></a></li><li class="toplevel"><a class="tocitem" href="#Exact-quadrature-version-2"><span>Exact quadrature version 2</span></a></li><li class="toplevel"><a class="tocitem" href="#Ignoring-higher-order-terms"><span>Ignoring higher order terms</span></a></li><li class="toplevel"><a class="tocitem" href="#Multiplying-nodal-points-together"><span>Multiplying nodal points together</span></a></li><li class="toplevel"><a class="tocitem" href="#Explicit-Example"><span>Explicit Example</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../physics/">Home</a></li><li><a class="tocitem" href="../convective_adjustment/">Convective Adjustment</a></li></ul></li><li><a class="tocitem" href="../function_index/">Function Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Discontinuous Galerkin</a></li><li class="is-active"><a href>Variational Crimes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Variational Crimes</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sandreza/DG_Playground/blob/master/docs/src/inexact_quadrature.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="sec:variational_crimes"><a class="docs-heading-anchor" href="#sec:variational_crimes">Variational Crimes</a><a id="sec:variational_crimes-1"></a><a class="docs-heading-anchor-permalink" href="#sec:variational_crimes" title="Permalink"></a></h1><p>We will use the same notation as <a href="../dg_single_element/#sec:single_element">Single Element</a>. The other thing that makes DG different from finite volume is <a href="https://en.wikipedia.org/wiki/Aliasing">aliasing</a> issues. Consider Burgers&#39; equation, which is the nonlinear PDE</p><div>\[\begin{aligned}
    \partial_t \rho + \partial_x f &amp;= 0 \\
    f &amp;= \rho^2
\end{aligned}\]</div><p>In the Discontinuous Galerkin method all quantities are interpreted as belong to the polynomial basis set, including the flux term <span>$f$</span>, i.e., we represent our functions as</p><div>\[\begin{aligned}
    \rho &amp;= \rho_i \ell_i \text{ and }
    f = f_i \ell_i ,
\end{aligned}\]</div><p>which are polynomials of degree <span>$N$</span>, for <span>$i = 0, ..., N$</span>. But yet <span>$f$</span> involves a \textit{product} of two polynomials of degree <span>$N$</span>, which is a polynomial of degree <span>$2N$</span>. This is not an issue in finite volume codes where <span>$N = 0$</span> so that <span>$2N = 0$</span>, but can sometimes lead to issues in Discontinuous Galerkin codes. This is the classic <a href="https://en.wikipedia.org/wiki/Turbulence_modeling">closure problem</a> but in the context of numerical methods.</p><p>Thus we must define in what sense we are representing a polynomial of degree <span>$2N$</span> by a polynomial of degree <span>$N$</span>. We will discuss four (non-exhaustive) options</p><ol><li>Exact quadrature version 1</li><li>Exact quadrature version 2</li><li>Ignoring higher order terms, (Polynomials of Degree <span>$N+1$</span> and higher)</li><li>Multiplying nodal points together</li></ol><h1 id="Exact-quadrature-version-1"><a class="docs-heading-anchor" href="#Exact-quadrature-version-1">Exact quadrature version 1</a><a id="Exact-quadrature-version-1-1"></a><a class="docs-heading-anchor-permalink" href="#Exact-quadrature-version-1" title="Permalink"></a></h1><p>For exact quadrature we satisfy the nonlinear flux relation in the same sense that we are satisfying the PDE. We multiply through by test functions <span>$\psi$</span> and integrate,</p><div>\[\begin{aligned}
   \int_\Omega \psi f = \int_\Omega \psi \rho^2.
\end{aligned}\]</div><p>We represent functions as <span>$f = f_j \ell_j$</span> and <span>$\rho_j \ell_j$</span> so that the equation becomes</p><div>\[\begin{aligned}
    \int_\Omega \psi f_j \ell_j = \int_\Omega \psi \rho_j \ell_j \rho_k \ell_k.
\end{aligned}\]</div><p>We the take our test function space to be the same as our basis function space <span>$\psi = \ell_i$</span> to get</p><div>\[\begin{aligned}
     \int_\Omega \ell_i  \ell_j f_j = \int_\Omega \ell_i  \ell_j  \ell_k \rho_j \rho_k.
\end{aligned}\]</div><p>The first term is just the entries of the mass matrix, i.e.,</p><div>\[\begin{aligned}
  \mathcal{M}_{ij}  =  \int_\Omega \ell_i  \ell_j ,
\end{aligned}\]</div><p>But for quadratic nonlinearities we need to compute integrals like</p><div>\[\begin{aligned}
   \mathcal{Q}^1_{ijk} \equiv \int_\Omega \ell_i(x) \ell_j(x) \ell_k(x)
\end{aligned}\]</div><p>which is a new object <span>$\mathcal{Q}^1$</span>. Thus we represent the equation as follows</p><div>\[\begin{aligned}
    \partial_t \mathcal{M}_{ij} \rho_j - \mathcal{S}_{ji} f_j &amp;= \delta_{0i} f^*(x=-1,t) - \delta_{Ni} f^*(x=1,t)
    \\
    \mathcal{M}_{ij} f_j &amp;= \mathcal{Q}_{ijk}^1 \rho_j \rho_k
\end{aligned}\]</div><h1 id="Exact-quadrature-version-2"><a class="docs-heading-anchor" href="#Exact-quadrature-version-2">Exact quadrature version 2</a><a id="Exact-quadrature-version-2-1"></a><a class="docs-heading-anchor-permalink" href="#Exact-quadrature-version-2" title="Permalink"></a></h1><p>This is similar to the previous one, except we directly represent the derivative term</p><div>\[\begin{aligned}
   \mathcal{Q}^2_{ijk} \equiv \int_\Omega \ell_i&#39;(x) \ell_j(x) \ell_k(x)
\end{aligned}\]</div><p>so that the discrete equations are</p><div>\[\begin{aligned}
    \partial_t \mathcal{M}_{ij} \rho_j - \mathcal{Q}^2_{ijk} \rho_j \rho_k &amp;= \delta_{0i} f^*(x=-1,t) - \delta_{Ni} f^*(x=1,t)
\end{aligned}\]</div><h1 id="Ignoring-higher-order-terms"><a class="docs-heading-anchor" href="#Ignoring-higher-order-terms">Ignoring higher order terms</a><a id="Ignoring-higher-order-terms-1"></a><a class="docs-heading-anchor-permalink" href="#Ignoring-higher-order-terms" title="Permalink"></a></h1><p>We carry through the multiplication of the polynomials, but just chop off all the terms corresponding to higher order terms. This can be done by ignoring higher Legendre modes (which is consistent with &quot;Exact Quadrature version 1&quot;) or by ignoring the monomial terms (which is not consistent with &quot;Exact Quadrature version 1&quot;).</p><h1 id="Multiplying-nodal-points-together"><a class="docs-heading-anchor" href="#Multiplying-nodal-points-together">Multiplying nodal points together</a><a id="Multiplying-nodal-points-together-1"></a><a class="docs-heading-anchor-permalink" href="#Multiplying-nodal-points-together" title="Permalink"></a></h1><p>One perspective is that we are satisfying the equation</p><div>\[\begin{aligned}
    f_i \ell_i = (\rho_i \ell_i) (\rho_j \ell_j)
\end{aligned}\]</div><p>exactly at the nodal points. This leads to <span>$f_j = (\rho_j)^2$</span>. If we do so the we are mixing discretizations. Another perspective is that we approximate &quot;exact quadrature version 1&quot;,  as</p><div>\[\begin{aligned}
   [\mathcal{Q}_1]_{ijk} \equiv \int_\Omega \ell_i(x) \ell_j(x) \ell_k(x) \approx \mathcal{M}_{ij} \delta_{jk}
\end{aligned}\]</div><p>so that <span>$f_j = (\rho_j)^2$</span>. This is also known as inexact quadrature or a variational crime. This approximation can lead to instability issues which are ameliorated either through dissipation, increasing resolution, or filters. When things are very resolved the higher order polynomial terms don&#39;t really play a role. This can either occur due <span>$h$</span>-refinement, since things are locally linear, or <span>$p-$</span>refinement for more complex reasons. The reasons are analogous to what happens with Fourier modes of analytic functions. Higher Fourier modes don&#39;t really matter since they decay exponentially and become negligible.</p><h1 id="Explicit-Example"><a class="docs-heading-anchor" href="#Explicit-Example">Explicit Example</a><a id="Explicit-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Explicit-Example" title="Permalink"></a></h1><p>We now go through an explicit example of the differences for linear elements / polynomial order 1. Here the Lagrange interpolants are</p><div>\[\begin{aligned}
    \ell_0(x) = (x-1)/ (-2) \text{ and } \ell_1(x) = (x+1) / 2
\end{aligned}\]</div><p>We can perform all integrals from the previous section</p><div>\[\begin{aligned}
    \mathcal{Q}^1_{000} &amp;= \mathcal{Q}^1_{111} =  1/2 \\
    \mathcal{Q}^1_{011} &amp;= \mathcal{Q}^1_{101} = \mathcal{Q}^1_{110} = 1/6
    \\
    \mathcal{Q}^1_{100} &amp;=
    \mathcal{Q}^1_{010} =
    \mathcal{Q}^1_{001} = 1/6
\end{aligned}\]</div><p>so that</p><div>\[\begin{aligned}
    \begin{bmatrix}
    2/3 &amp; 1/3 \\
    1/3 &amp; 2/3
    \end{bmatrix}
    \begin{bmatrix}
    f_0 \\
    f_1
    \end{bmatrix}
    &amp;=
        \begin{bmatrix}
    1/2 &amp; 1/3 &amp; 1/6 \\
    1/6 &amp; 1/3 &amp; 1/2
    \end{bmatrix}
        \begin{bmatrix}
    (\rho_0)^2 \\
    \rho_0 \rho_1 \\
    (\rho_1)^2
    \end{bmatrix}
\end{aligned}\]</div><p>which is</p><div>\[\begin{aligned}
        \begin{bmatrix}
    f_0 \\
    f_1
    \end{bmatrix}
    &amp;=
        \begin{bmatrix}
    5/6 &amp; 1/3 &amp; -1/6 \\
    -1/6 &amp; 1/3 &amp; 5/6
    \end{bmatrix}
        \begin{bmatrix}
    (\rho_0)^2 \\
    \rho_0 \rho_1 \\
    (\rho_1)^2
    \end{bmatrix}
\end{aligned}\]</div><p>For the other operator we have</p><div>\[\begin{aligned}
    \mathcal{Q}^2_{000} &amp;= [\mathcal{Q}_2]_{011} = -1/3
    \\
    \mathcal{Q}^2_{010} &amp;= \mathcal{Q}^2_{001} = -1/6
    \\
    \mathcal{Q}^2_{1ij} &amp;= -[\mathcal{Q}_2]_{0ij}  
\end{aligned}\]</div><p>Note that <span>$\mathcal{S}_{ji}\mathcal{Q}^1_{jks} = \mathcal{Q}^2_{iks}$</span>. The two ``exact quadrature&quot; versions coincide for linear elements.</p><p>Now let us check to see what it means to lop off higher  order terms</p><div>\[\begin{aligned}
    4 \rho^2 &amp;= 4 \left(\rho_0 \frac{x-1}{-2} + \rho_1 \frac{x+1}{2} \right)^2
    \\
    &amp;= (\rho_0^2 + \rho_1^2 - 2 \rho_0 \rho_1) x^2
    + 2(\rho_0^2 - \rho_1^2)x + (\rho_0^2 + \rho_1^2 + 2 \rho_0 \rho_1)
    \\
    &amp;= (\rho_0 - \rho_1)^2 x^2
    + (3 \rho_0^2 - \rho_1^2 + 2\rho_0 \rho_1 )\frac{x-1}{-2} + (3 \rho_1^2 - \rho_0^2 + 2 \rho_0 \rho_1)\frac{x+1}{2}
\end{aligned}\]</div><p>In this case we just neglect the term in front of <span>$x^2$</span>. Thus <span>$f$</span> becomes</p><div>\[\begin{aligned}
        \begin{bmatrix}
    f_0 \\
    f_1
    \end{bmatrix}
    &amp;=
        \begin{bmatrix}
    3/4 &amp; 1/2 &amp; -1/4 \\
    -1/4 &amp; 1/2 &amp; 3/4
    \end{bmatrix}
        \begin{bmatrix}
    (\rho_0)^2 \\
    \rho_0 \rho_1 \\
    (\rho_1)^2
    \end{bmatrix}
\end{aligned}\]</div><p>If we had instead decided to take off the highest Legendre modes (as opposed to highest polynomial order), then we should reduce back to the exact quadrature formula (version 1). To see this first note that the first few legendre polynomials are</p><div>\[\begin{aligned}
    P_0(x) = 1 \text{ , } P_1(x) = x  \text { , and } P_2(x) = \frac{3}{2} \left(x^2 - \frac{1}{3} \right)
\end{aligned}\]</div><p>Thus if we rewrite expressions with the highest polynomial order instead represented instead as Legendre modes via <span>$x^2 = x^2 - 1/3 + 1/3 = 2/3 P_2(x) + 1/3$</span>, then we get</p><div>\[\begin{aligned}
    4 \rho^2 &amp;=
    (\rho_0 - \rho_1)^2 (x^2-1/3+1/3)
    \\
    &amp;+ (3 \rho_0^2 - \rho_1^2 + 2\rho_0 \rho_1 )\frac{x-1}{-2} + (3 \rho_1^2 - \rho_0^2 + 2 \rho_0 \rho_1)\frac{x+1}{2}
    \\
    &amp;= (\rho_0 - \rho_1)^2 \frac{2}{3} P_2(x)
    \\
    &amp;+ \left(\frac{10}{3} \rho_0^2 - \frac{2}{3}\rho_1^2 + \frac{4}{3} \rho_0 \rho_1 \right)\frac{x-1}{-2} + \left(\frac{10}{3} \rho_1^2 - \frac{2}{3} \rho_0^2 + \frac{4}{3} \rho_0 \rho_1  \right)\frac{x+1}{2}
\end{aligned}\]</div><p>Neglecting the higher order Legendre modes (in this case just <span>$P_2(x)$</span>, but in general much more). We indeed get (upon dividing by 4)</p><div>\[\begin{aligned}
        \begin{bmatrix}
    f_0 \\
    f_1
    \end{bmatrix}
    &amp;=
        \begin{bmatrix}
    5/6 &amp; 1/3 &amp; -1/6 \\
    -1/6 &amp; 1/3 &amp; 5/6
    \end{bmatrix}
        \begin{bmatrix}
    (\rho_0)^2 \\
    \rho_0 \rho_1 \\
    (\rho_1)^2
    \end{bmatrix}
\end{aligned}\]</div><p>as before.</p><p>And the last option is to represent <span>$f_0$</span> and <span>$f_1$</span> as</p><div>\[\begin{aligned}
        \begin{bmatrix}
    f_0 \\
    f_1
    \end{bmatrix}
    &amp;=
        \begin{bmatrix}
    1 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 1
    \end{bmatrix}
        \begin{bmatrix}
    (\rho_0)^2 \\
    \rho_0 \rho_1 \\
    (\rho_1)^2
    \end{bmatrix}
\end{aligned}\]</div><p>Again this just corresponds to multiplying things nodally, point by point. This option leads to code that is easy to write and is computationally cheap compared to the rest of the methods.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../boundary_conditions/">« Boundary Conditions</a><a class="docs-footer-nextpage" href="../physics/">Home »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 21 November 2020 20:43">Saturday 21 November 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
